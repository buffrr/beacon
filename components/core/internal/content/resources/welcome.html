<!DOCTYPE html>
<html>

<head>
    <link href="assets/style.css" rel="stylesheet">
    <title>Welcome to Beacon</title>
</head>

<body>
<div id="slides" style="margin-bottom:2em;">
    <div class="slide showing">
        <div class="logo">
            <img src="assets/logo.svg" style="max-width:100px;margin-top:2em">
            <h1> <span style="font-family: 'Roboto Bold';">Beacon</span> <span
                    style="font-family: 'Roboto Thin';">Beta</span></h1>
        </div>
        <div class="promo">
            <p>A first-class browsing experience for a decentralized internet built with web technologies and
                secured without third parties.
            </p>

        </div>
        <div class="cta" style="text-align:center;">
            <a href="javascript:void(0)" class="action">Continue</a>
        </div>
        <div style="max-width:480px;margin: 0 auto; margin-top:4em;color:#666768">
            <small>Note: beacon is still in beta don't make it your main browser just yet ;)</small>
            </footer>
        </div>
    </div>

    <div class="slide">
        <div class="slide-header">
            <div class="logo" style="margin-top:2.6em;">
                <div style="text-align:center;">
                    <svg width="300" height="255" viewBox="0 0 401 255" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="2.5" y="2.5" width="322" height="181" rx="2.5" stroke="#0C0C0C" stroke-width="5"/>
                        <rect x="34.5" y="32.5" width="321" height="182" rx="2.5" fill="#DDE1E2" stroke="#080908" stroke-width="5"/>
                        <rect id="active-block" x="77.5" y="71.5" width="321" height="181" rx="2.5" fill="#DDE1E2" stroke="black" stroke-width="5" stroke-dasharray="8 8"/>
                        <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="12" font-weight="bold" letter-spacing="0em"><tspan x="106.463" y="104.102">Urkel tree root</tspan></text>
                        <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="12" font-weight="bold" letter-spacing="0em"><tspan x="103.275" y="228.102" id="block-height">Height: 100,000</tspan></text>
                        <text fill="black" xml:space="preserve" style="white-space: pre" font-family="Roboto" font-size="12" letter-spacing="0em">
                                <tspan x="105.285" y="124.102" class="fade-text" id="urkel-row-1"></tspan>
                            <tspan x="105.467" y="138.102" class="fade-text" id="urkel-row-2"></tspan>
                            </text>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M368.762 210.765L366.75 207.122L370.649 207.123C370.753 207.123 370.875 207.194 370.931 207.289C370.993 207.393 371.309 207.926 371.69 208.564C372.146 209.329 372.69 210.243 373.002 210.765H368.762V210.765ZM361.552 232.828C361.457 233 361.335 233 361.294 233H359.701C358.858 233 357.886 232.998 357.306 232.998L363.5 221.665C363.661 221.373 363.557 221.002 363.271 220.839C363.182 220.788 363.083 220.761 362.982 220.761L352.427 220.776L350.327 217.071H365.703C365.704 217.071 365.706 217.071 365.707 217.071C365.709 217.071 365.71 217.071 365.712 217.071C365.721 217.071 365.729 217.068 365.737 217.068C365.771 217.066 365.805 217.062 365.839 217.054C365.864 217.047 365.89 217.039 365.913 217.03C365.926 217.025 365.94 217.019 365.952 217.014C366.072 216.962 366.171 216.87 366.234 216.754L368.769 211.978H372.954L361.552 232.828ZM356.277 232.397C356.142 232.171 355.967 231.877 355.776 231.558C355.136 230.48 354.316 229.101 354.223 228.949C354.192 228.899 354.178 228.774 354.243 228.654C354.392 228.382 357.195 223.235 357.878 221.981L361.972 221.976L356.277 232.397ZM349.297 225.305L347.262 221.621L349.313 217.703L351.37 221.332C350.731 222.559 349.733 224.472 349.297 225.305ZM346.566 225.878C345.531 225.878 344.5 225.878 344.35 225.878C344.249 225.878 344.127 225.806 344.071 225.712L343.409 224.6C342.936 223.807 342.333 222.795 342 222.235H346.238L348.25 225.878C347.811 225.878 347.189 225.878 346.566 225.878ZM353.448 200.174C353.543 200 353.665 200 353.704 200H357.708L351.497 211.333C351.492 211.343 351.489 211.352 351.484 211.363C351.475 211.382 351.467 211.401 351.46 211.422C351.453 211.441 351.447 211.46 351.443 211.48C351.438 211.501 351.433 211.517 351.43 211.536C351.427 211.558 351.424 211.58 351.424 211.603C351.424 211.613 351.421 211.622 351.421 211.633C351.421 211.641 351.422 211.648 351.424 211.656C351.424 211.678 351.427 211.7 351.43 211.722C351.432 211.741 351.435 211.758 351.44 211.777C351.444 211.796 351.45 211.815 351.457 211.834C351.463 211.853 351.469 211.87 351.477 211.889C351.484 211.908 351.494 211.924 351.503 211.94C351.512 211.956 351.522 211.973 351.534 211.989C351.545 212.005 351.557 212.021 351.571 212.035C351.584 212.049 351.596 212.063 351.61 212.077C351.624 212.092 351.638 212.101 351.653 212.114C351.67 212.126 351.688 212.139 351.705 212.15C351.711 212.155 351.717 212.16 351.723 212.164C351.729 212.169 351.737 212.169 351.745 212.174C351.776 212.19 351.808 212.204 351.841 212.213C351.853 212.216 351.864 212.221 351.877 212.224C351.92 212.235 351.965 212.242 352.011 212.242C352.011 212.242 352.011 212.242 352.013 212.242H352.015H352.278C352.28 212.242 352.281 212.242 352.281 212.242L362.572 212.227C362.844 212.709 363.353 213.618 363.785 214.39C364.117 214.984 364.393 215.474 364.61 215.859H349.296C349.29 215.859 349.283 215.861 349.276 215.863C349.06 215.864 348.863 215.987 348.761 216.18L346.225 221.024H342.048C343.872 217.682 353.326 200.395 353.448 200.174ZM358.731 200.618L359.103 201.242C359.755 202.34 360.678 203.889 360.775 204.051C360.806 204.101 360.82 204.226 360.755 204.346L357.122 211.016L353.03 211.021L358.731 200.618ZM365.701 207.692L367.736 211.378L365.661 215.288C365.413 214.848 365.106 214.299 364.818 213.784C364.247 212.766 363.832 212.025 363.598 211.611C364.043 210.787 365.211 208.602 365.701 207.692Z" fill="black"/>
                    </svg>

                </div>
             

                <h2 style="font-family: 'Roboto Bold';margin:0 auto; max-width:300px;text-align: center;">Securing the web without certificate authorities.</h2>
            </div>
            <div class="promo-2">
                <p>Beacon connects to the Handshake peer-to-peer network and syncs block headers in just a few
                    seconds! It verifies HNS domains without trusting any central entity.
                </p>
                <p>The light client obtains and verifies the most up to date Urkel tree root from peers which is then used to secure the DNSSEC chain to get you truly end-to-end encrypted HTTPS!</p>
            </div>
        </div>
        <div class="cta" style="text-align:center;">
            <a href="javascript:void(0)" class="action">Continue</a>
        </div>

    </div>

    <div class="slide ">
        <div class="logo" style="max-width:480px;">
            <img src="assets/forever.svg" style="max-width:220px;margin-top:2em;">
            <h3 style="font-family: 'Roboto Bold';text-align:left;"> Access names on Ethereum</h1>
        </div>
        <div class="promo" style="margin-top:0.5em;max-width:480px;text-align:left;font-size:16px;">
            <p>Forever domains are domains with no renewal fees, ever. They are deployed on Ethereum and not
                controlled by anyone. Try opening impervious.forever!
            </p>
            <p>Beacon enables you to access names on Ethereum Name System too, try humbly.eth.</p>
            <small>Note: we still rely on gateways to access Ethereum names until their peer-to-peer network becomes
                more accessible to light clients.</small>

        </div>
        <div class="cta" style="text-align:center;">
            <a href="javascript:void(0)" class="action action-last">Continue</a>
        </div>
        <div style="max-width:480px;margin: 0 auto; margin-top:4em;color:#666768">
            </footer>
        </div>
    </div>

    <div class="slide">
        <div class="logo" style="max-width:480px;">
            <img src="assets/hns.svg"
                 style="max-width:40px;margin-top:2em;background-color: #DDE1E2;padding:2em;border-radius:50%;border:2px solid #000;">
            <h3 style="font-family: 'Roboto Bold';text-align:left;">Sync Status</h1>
        </div>
        <div class="promo" style="margin-top:0.5em;max-width:480px;text-align:left;font-size:16px;">
            <p>It may take a few seconds to finish syncing. You can continue browsing; HNS domains will be accessible once it's ready.</p>

            <div class="sync-bar-block-height">Block height #0</div>
            <div class="sync-bar-outer">
                <div id="sync-bar" class="sync-bar"></div>
            </div>
        </div>

        <div class="cta" style="text-align:center;">
            <a href="javascript:void(0)" class="action action-secondary action-last action-skip">Skip</a>
        </div>
        <div style="max-width:480px;margin: 0 auto; margin-top:4em;color:#666768">
            </footer>
        </div>
    </div>
</div>
<script>
    let currentSlide = 0;
    let lastUrkel = '';
    let synced = false;

    const slides = document.querySelectorAll('#slides .slide');
    const actions = document.querySelectorAll('.action');
    const finalActions = document.querySelectorAll('.action-last');
    const syncBar = document.querySelector('.sync-bar');
    const syncBarBH = document.querySelector('.sync-bar-block-height');
    const blockHeight = document.getElementById('block-height');
    const urkelRow1 = document.getElementById('urkel-row-1');
    const urkelRow2 = document.getElementById('urkel-row-2');

    function pickSlide(num) {
        slides[currentSlide].className = 'slide';
        currentSlide = num;
        slides[currentSlide].className = 'slide showing';
    }

    function nextSlide(e) {
        e.preventDefault();
        if (this.classList.contains('action-skip') ||
            (synced && this.classList.contains('action-last'))) {
            window.parent.postMessage('done', 'chrome://welcome');
            return false;
        }
        pickSlide((currentSlide + 1) % slides.length);
        return false;
    }

    function setProgress(progress) {
        syncBar.style.width = progress + '%';
    }

    Array.from(actions).forEach(function (element) {
        element.addEventListener('click', nextSlide);
    });

    async function updateUI() {
        let res = null;
        try {
            res = await window.fetch("info.json");
        } catch (e) {
            console.log(e);
            return;
        }

        if (res.status !== 200) {
            console.log(res);
            return;
        }

        const data = await res.json();
        if (!data) return;
        if (lastUrkel !== data.urkel) {
            const half = data.urkel.length / 2;
            updateTextWithTransition(urkelRow1, data.synced,
                             data.urkel.substring(0, half).trim());
            updateTextWithTransition(urkelRow2, data.synced,
                data.urkel.substring(half).trim());

            lastUrkel = data.urkel;
       }

        synced = data.synced;
        if (synced) {
            Array.from(finalActions).forEach(function (element) {
                element.classList.remove('action-secondary');
                element.textContent = 'Done!';
                element.classList.add('last-action');
            });
        }

        blockHeight.textContent = data.height === 0 ?
            "Syncing ..." : "Height: " + data.height;

        setProgress(data.progress);
        syncBarBH.textContent = blockHeight.textContent;
    }

    function updateTextWithTransition(node, synced, text) {
        node.classList.add("tree-scan");
        setTimeout(() => {
            requestAnimationFrame(() => {
                node.textContent = text;
                node.classList.remove("tree-scan");
            });
        }, 400); // timeout
    }

    setInterval(updateUI, 600);
</script>
</body>

</html>
